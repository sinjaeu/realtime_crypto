# 🏗️ 암호화폐 모의 투자 플랫폼 - 전체 구조 설계

## 📁 프로젝트 디렉토리 구조

```
realtime_data/
├── 📊 데이터 파이프라인 (기존 - 완료)
│   ├── kafka_services/
│   │   ├── producers/crypo_producer.py
│   │   ├── consumers/crypo_consumers.py
│   │   └── requirements_kafka.txt
│   ├── dags/
│   │   ├── crypo_data.py
│   │   └── crypto_batch_processing.py
│   └── models/
│       ├── xgboost_best_model.pkl
│       └── label_encoder.pkl
│
├── 🌐 웹 애플리케이션 (신규 구현)
│   ├── backend/                    # FastAPI 백엔드
│   │   ├── app/
│   │   │   ├── __init__.py
│   │   │   ├── main.py            # FastAPI 앱 엔트리포인트
│   │   │   ├── api/               # API 라우터
│   │   │   │   ├── __init__.py
│   │   │   │   ├── auth.py        # 사용자 인증
│   │   │   │   ├── market.py      # 시장 데이터 API
│   │   │   │   ├── trading.py     # 거래 API
│   │   │   │   └── ai.py          # AI 예측 API
│   │   │   ├── core/              # 핵심 설정
│   │   │   │   ├── __init__.py
│   │   │   │   ├── config.py      # 환경 설정
│   │   │   │   ├── security.py    # JWT, 암호화
│   │   │   │   └── database.py    # DB 연결
│   │   │   ├── models/            # 데이터 모델
│   │   │   │   ├── __init__.py
│   │   │   │   ├── user.py        # 사용자 모델
│   │   │   │   ├── portfolio.py   # 포트폴리오 모델
│   │   │   │   └── transaction.py # 거래 모델
│   │   │   ├── services/          # 비즈니스 로직
│   │   │   │   ├── __init__.py
│   │   │   │   ├── redis_service.py    # Redis 연동
│   │   │   │   ├── trading_service.py  # 거래 로직
│   │   │   │   ├── ai_service.py       # AI 예측 로직
│   │   │   │   └── websocket_service.py # 실시간 데이터
│   │   │   └── utils/             # 유틸리티
│   │   │       ├── __init__.py
│   │   │       └── helpers.py
│   │   ├── requirements_backend.txt
│   │   └── Dockerfile
│   │
│   └── frontend/                   # React 프론트엔드
│       ├── public/
│       │   ├── index.html
│       │   └── favicon.ico
│       ├── src/
│       │   ├── components/        # 재사용 컴포넌트
│       │   │   ├── common/        # 공통 컴포넌트
│       │   │   │   ├── Header.tsx
│       │   │   │   ├── Sidebar.tsx
│       │   │   │   └── Loading.tsx
│       │   │   ├── charts/        # 차트 컴포넌트
│       │   │   │   ├── PriceChart.tsx
│       │   │   │   ├── PortfolioChart.tsx
│       │   │   │   └── TradingView.tsx
│       │   │   ├── trading/       # 거래 컴포넌트
│       │   │   │   ├── OrderForm.tsx
│       │   │   │   ├── OrderBook.tsx
│       │   │   │   └── TradeHistory.tsx
│       │   │   └── ai/            # AI 컴포넌트
│       │   │       ├── PredictionPanel.tsx
│       │   │       ├── AIChat.tsx
│       │   │       └── MarketAnalysis.tsx
│       │   ├── pages/             # 페이지 컴포넌트
│       │   │   ├── Dashboard.tsx  # 메인 대시보드
│       │   │   ├── Trading.tsx    # 거래 페이지
│       │   │   ├── Portfolio.tsx  # 포트폴리오 페이지
│       │   │   ├── AIAssistant.tsx # AI 어시스턴트 페이지
│       │   │   └── Settings.tsx   # 설정 페이지
│       │   ├── services/          # API 서비스
│       │   │   ├── api.ts         # API 클라이언트
│       │   │   ├── websocket.ts   # WebSocket 클라이언트
│       │   │   └── auth.ts        # 인증 서비스
│       │   ├── hooks/             # 커스텀 훅
│       │   │   ├── useWebSocket.ts
│       │   │   ├── useAuth.ts
│       │   │   └── useMarketData.ts
│       │   ├── store/             # 상태 관리 (Redux/Zustand)
│       │   │   ├── slices/
│       │   │   │   ├── authSlice.ts
│       │   │   │   ├── marketSlice.ts
│       │   │   │   └── portfolioSlice.ts
│       │   │   └── store.ts
│       │   ├── types/             # TypeScript 타입 정의
│       │   │   ├── api.ts
│       │   │   ├── market.ts
│       │   │   └── user.ts
│       │   ├── utils/             # 유틸리티 함수
│       │   │   ├── formatters.ts  # 데이터 포맷팅
│       │   │   ├── constants.ts   # 상수 정의
│       │   │   └── helpers.ts
│       │   ├── styles/            # 스타일 파일
│       │   │   ├── globals.css
│       │   │   └── components/
│       │   ├── App.tsx
│       │   └── index.tsx
│       ├── package.json
│       ├── package-lock.json
│       ├── tsconfig.json
│       └── Dockerfile
│
├── 🐳 Docker 설정 (기존 + 확장)
│   ├── docker-compose.yaml        # 전체 서비스 오케스트레이션
│   ├── Dockerfile                 # Airflow 커스텀 이미지
│   └── nginx/                     # 리버스 프록시 (선택사항)
│       ├── nginx.conf
│       └── Dockerfile
│
├── 📋 설정 파일들
│   ├── .env                       # 환경 변수
│   ├── .gitignore
│   ├── requirements.txt           # Python 의존성
│   ├── README.md
│   └── 프로젝트_구조_설계.md     # 이 파일
│
└── 📊 문서화
    ├── 프로젝트_진행도_상세분석.txt
    ├── 프로젝트_구현_계획서.txt
    └── API_문서.md                # API 명세서 (신규)
```

## 🔧 기술 스택 상세

### Backend (FastAPI)
- **FastAPI**: 고성능 Python 웹 프레임워크
- **Uvicorn**: ASGI 서버
- **SQLAlchemy**: ORM (PostgreSQL 연동)
- **Redis-py**: Redis 클라이언트
- **JWT**: 토큰 기반 인증
- **WebSocket**: 실시간 통신
- **Pydantic**: 데이터 검증

### Frontend (React)
- **React 18**: 최신 React
- **TypeScript**: 타입 안전성
- **Vite**: 빠른 빌드 도구
- **Chart.js / Recharts**: 차트 라이브러리
- **Material-UI (MUI)**: UI 컴포넌트 라이브러리
- **Redux Toolkit**: 상태 관리
- **React Query**: 서버 상태 관리
- **WebSocket API**: 실시간 데이터 수신

### 인프라 & DevOps
- **Docker & Docker Compose**: 컨테이너화
- **Nginx**: 리버스 프록시 & 정적 파일 서빙
- **Redis**: 캐싱 & 세션 스토어
- **PostgreSQL**: 메인 데이터베이스
- **Kafka**: 실시간 데이터 스트리밍

## 🌐 API 설계

### REST API 엔드포인트
```
POST   /api/auth/login          # 로그인
POST   /api/auth/register       # 회원가입
GET    /api/auth/me            # 현재 사용자 정보

GET    /api/market/prices      # 현재 가격 조회
GET    /api/market/history     # 가격 히스토리
GET    /api/market/symbols     # 지원 심볼 목록

GET    /api/portfolio          # 포트폴리오 조회
POST   /api/trading/buy        # 매수 주문
POST   /api/trading/sell       # 매도 주문
GET    /api/trading/orders     # 주문 내역
GET    /api/trading/history    # 거래 내역

POST   /api/ai/predict         # 가격 예측 요청
GET    /api/ai/analysis        # 시장 분석
POST   /api/ai/chat            # AI 채팅
```

### WebSocket 채널
```
/ws/prices                     # 실시간 가격 업데이트
/ws/portfolio                  # 포트폴리오 변경 알림
/ws/orders                     # 주문 상태 업데이트
```

## 🔄 데이터 흐름

### 실시간 가격 데이터
```
Binance API → Kafka Producer → Kafka → Consumer → Redis → FastAPI → WebSocket → React
```

### 사용자 거래
```
React → FastAPI → PostgreSQL (거래 저장) → Redis (포트폴리오 캐시) → WebSocket → React
```

### AI 예측
```
React → FastAPI → XGBoost 모델 → 예측 결과 → React
```

## 🚀 개발 단계별 계획

### Phase 1: Backend API 기반 구축
1. FastAPI 프로젝트 초기화
2. Redis 연동 및 실시간 데이터 API
3. 사용자 인증 시스템
4. WebSocket 실시간 통신

### Phase 2: Frontend 기본 구조
1. React 프로젝트 초기화
2. 기본 UI/UX 구성
3. 실시간 가격 차트 구현
4. 사용자 인증 UI

### Phase 3: 거래 시스템
1. 모의 거래 로직 구현
2. 포트폴리오 관리 시스템
3. 거래 히스토리 및 분석

### Phase 4: AI 기능 통합
1. XGBoost 모델 API 연동
2. AI 어시스턴트 채팅 인터페이스
3. 투자 분석 및 추천 시스템

### Phase 5: 최적화 및 배포
1. 성능 최적화
2. 보안 강화
3. 모니터링 시스템
4. 배포 자동화

## 📊 데이터베이스 스키마 (PostgreSQL)

### Users Table
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    balance DECIMAL(15,2) DEFAULT 100000.00,  -- 초기 가상 자금
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Portfolios Table
```sql
CREATE TABLE portfolios (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    symbol VARCHAR(20) NOT NULL,
    quantity DECIMAL(15,8) NOT NULL,
    avg_price DECIMAL(15,8) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Transactions Table
```sql
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    symbol VARCHAR(20) NOT NULL,
    type VARCHAR(10) NOT NULL, -- 'BUY' or 'SELL'
    quantity DECIMAL(15,8) NOT NULL,
    price DECIMAL(15,8) NOT NULL,
    total_amount DECIMAL(15,2) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 🔐 보안 고려사항

1. **JWT 토큰**: 사용자 인증
2. **CORS 설정**: 프론트엔드 도메인 허용
3. **Rate Limiting**: API 호출 제한
4. **Input Validation**: Pydantic 모델 검증
5. **HTTPS**: SSL/TLS 암호화 (배포 시)
6. **Environment Variables**: 민감 정보 환경변수 관리

## 🎯 성능 최적화

1. **Redis 캐싱**: 자주 조회되는 데이터 캐싱
2. **Connection Pooling**: 데이터베이스 연결 풀
3. **WebSocket**: 실시간 데이터 효율적 전송
4. **Code Splitting**: React 앱 번들 최적화
5. **CDN**: 정적 파일 배포 (배포 시)

---

이 구조를 바탕으로 단계별로 개발을 진행하면 체계적이고 확장 가능한 암호화폐 모의 투자 플랫폼을 구축할 수 있습니다!
